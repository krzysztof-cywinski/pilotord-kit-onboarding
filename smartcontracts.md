# Interaction with smart contracts

## Objective

This documentation aims to explain how interaction with the smart contracts available on the Real Digital Pilot Network will be done.

As this is a pilot in a test environment, this documentation is subject to constant evolutions that will be reflected here.

The participant of the pilot will be provided with the ABI of each of the contracts and their respective addresses published on the network. Each participant must implement, in the way that best understands, their interaction with the contracts, making use of standard Web3 libraries such as, for example, [Web3JS](https://web3js.readthedocs.io/en/v1.10.0/), [Web3J](https://docs.web3j.io/4.10.0/), or frameworks such as [Hardhat](https://hardhat.org/) or [Truffle](https://trufflesuite.com/).

In the pilot, all contracts will be implemented and published on the network by the Central Bank of Brazil.

## Smart Contracts

The contracts that represent tokens (Real Digital and Tokenized Real) were developed using the [ERC20](https://ethereum.org/pt/developers/docs/standards/tokens/erc-20/) standard as a basis, with the addition of [specific access control functions](./CBDCAccessControl.md).
All tokens support 2 decimal places.

The contracts for operations (public offering settlement and buying and selling) involving TPFt were developed using the [ERC1155](https://ethereum.org/pt/developers/docs/standards/tokens/erc-1155/) standard as a basis, with the addition of specific [access control functions](./TPFtAccessControl.md).

An operation will be uniquely identified by the operationId provided by the participant. This number will be unique on the network and it is suggested to use the participant's range number concatenated with the current date. This format will not be validated and the operationId will be used to match a double command operation.

The unit price, quantity, and financial value will be treated in the contracts assuming the last digits as decimal places according to each attribute type. If the attribute is an integer, the number of decimal places must be filled with zeros in the last digits.

### CBDC - [Real Digital](./RealDigital.md)

The CBDC (Central Bank Digital Currency) is defined in the contract called [RealDigital](./abi/RealDigital.json).
* The wallet of the Central Bank of Brazil is the token manager.
* The token symbol is `BRL`.
* Only authorized wallets can receive Real Digital.
* Each participant must send the address of their main wallet to the Central Bank of Brazil for registration. This wallet will be the participant's default wallet. After the initial registration, the participant can enable other wallets to receive Real Digital, as well as change their default wallet.

The default wallet will be mainly used in the swap contracts, detailed below.

### DVt (Tokenized Sight Deposit) and MEt (Tokenized Electronic Currency) - [Tokenized Real](./RealTokenizado.md)

Tokenized Real is defined in the contract called [RealTokenizado](./abi/RealTokenizado.json).
* The participant's default wallet will be the token manager, but the creation of the token on the network will be done by the Central Bank of Brazil.
* The token symbol is to be defined.
* Like Real Digital, only authorized wallets can receive Tokenized Real.
* The participant must use the `enableAccount` and `disableAccount` methods to manage the allowed wallets.

### [STR](./STR.md)

The contract called [STR](./abi/STR.json) represents how participants will request Real Digital from the Central Bank of Brazil. This contract allows any participant to request the minting of Real Digital, provided that their wallet is registered, using the `requestToMint` method.

### [Real Digital Default Account](./RealDigitalDefaultAccount.md)

The [RealDigitalDefaulAccount](./abi/RealDigitalDefaultAccount.json) contract allows the participant to change their default wallet through the `updateDefaultWallet` method. Also, through the `defaultAccount` mapping, it is possible to recover the default wallet of other participants, simply by passing their CNPJ8 as a parameter. This operation will be necessary for swap transactions.

### [Real Digital Enable Account](./RealDigitalEnableAccount.md)

The [RealDigitalEnableAccount](./abi/RealDigitalEnableAccount.json) contract allows the participant to enable other wallets they own to receive Real Digital, through the `enableAccount` method.

### [KeyDictionary](./KeyDictionary.md)

The [KeyDictionary](./abi/KeyDictionary.json) contract simulates a DICT for Real Digital. During the pilot, fictitious client data must be inserted into the network for recovery during swap operations.
The method to be invoked for data insertion is `addAccount`, which has the following parameters:

* Key, a unique identifier generated by the participant, must be saved in keccak256 hash format
* CPF of the fictitious client
* Participant code
* Fictitious client account
* Fictitious client

### TPFt â€“ Tokenized Federal Public Debt

TPFt is defined in a private contract managed by Selic.

- TPFt is fungible and identified by its code, acronym, and maturity date.
- The wallet of the National Treasury Secretariat (STN) is the token manager.
- Only authorized wallets can receive TPFt.
- The tokens made available will follow the [characteristics of Federal Public Debt Securities](https://www.bcb.gov.br/content/estabilidadefinanceira/selic/CaracteristicaTitulos.pdf).

### Public Offering Settlement - [Operation 1002](./ITPFtOperation1002.md)

The public offering settlement is defined in the contract called TPFtOperation1002, which implements the interface [ITPFtOperation1002](./abi/ITPFtOperation1002.json). The contract allows the transfer of whole quantities of TPFt from the STN's default wallet to the default wallet of a registered participant through the `auctionPlacement` method. The settlement of the operation is carried out with delivery versus payment (DvP), and only the Central Bank of Brazil can transmit the seller's command of this operation.

### Buying and Selling - [Operation 1052](./ITPFtOperation1052.md)

The buying and selling operation between participants and/or clients is defined in the contract called TPFtOperation1052, which implements the interface [ITPFtOperation1052](./abi/ITPFtOperation1052.json). The contract allows the transfer of fractional quantities of TPFt between wallets of registered participants and/or clients through the `trade` method. The settlement of the operation is executed with delivery versus payment (DvP).

## Swap and Off-Chain Communication

The swap contracts allow the exchange of Tokenized Real between participants, using Real Digital as a reserve.

At the moment, there are two available implementations: one that executes the swap in just [one transaction](./abi/SwapOneStep.json) and another that depends on the [receiver's approval](./abi/SwapTwoSteps.json) for the exchange to be completed, thus requiring two transactions on the network.

For more details, read the documentation of the [SwapOneStep](./SwapOneStep.md) and [SwapTwoSteps](./SwapTwoSteps.md) contracts.

The objective of the pilot is to test the two forms of swap, as well as a third that will still be implemented and involves off-chain information exchange.


[<<< Back](README.md)